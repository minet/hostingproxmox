<div *ngIf="(loading || deletionStatus != 'None') && (user.chartevalidated || user.admin) && (errorcode !== 500)">
    <div class="d-flex justify-content-center">
        <div class="spinner-grow text-primary" role="status">
            <span class="sr-only">{{'vm.loading' | translate}}</span>
        </div>
    </div>
</div>
<div *ngIf="errorcode !== 201 && errorcode !== 200" class="alert alert-danger text-center" role="alert">
    <br>{{ displayError(errorcode)}}<br>
    {{ errorDescription }}
    <br><br>
    
    <br><a [routerLink]="['/']">{{'vm.errorBackHome' | translate}}</a>
</div>
<div class="container text-center" *ngIf="!loading  && errorcode === 201 && (user.chartevalidated || user.admin)">
    <h1 class="text-center mb-2">VM: {{ user.vms[0].name }}</h1>
    <hr>
    <div class="alert"
         [ngClass]="{
                    'alert-danger': user.vms[0].status === 'stopped' || deletionStatus == 'deleting' ,
                    'alert-info': user.vms[0].status === 'creating',
                    'alert-warning': user.vms[0].status === 'booting',
                    'alert-success': user.vms[0].status === 'running' || deletionStatus == 'deleted'
                    }"
    ><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"
           *ngIf="user.vms[0].status === 'booting'  || user.vms[0].status === 'creating' || deletionStatus == 'deleting' || deletionStatus == 'deleted'"></span>{{'vm.status' | translate}} :&nbsp;{{ deletionStatus != 'None' ? deletionStatus  : user.vms[0].status | translate }}
    </div>
    <div *ngIf="deletionStatus != 'deleting' && deletionStatus != 'deleted'">
    <hr>
    <div class="row" >
        <div class="col-md-6">
            <div class="card">
                <div class="card-body" >
                    <h4>{{'vm.information' | translate}}</h4>
                    <hr>
                    <div class="row">
                        <div class="col-6 text-left">
                            <p><b>{{'vm.id' | translate}} :</b>&nbsp; {{ user.vms[0].id }}</p>
                            <p><b>{{'vm.type' | translate}} :</b>&nbsp; {{ user.vms[0].type }}</p>
                            <p><b>{{'vm.status' | translate}} :</b>&nbsp; {{ user.vms[0].status }}</p>
                            <p><b>{{'vm.name' | translate}} :</b>&nbsp; {{ user.vms[0].name }}</p>
                            <p><b>{{'vm.ipv4' | translate}} :</b>&nbsp; {{ user.vms[0].ip }}
                            <p><b>{{'vm.startOnBoot' | translate}} :</b>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" (change)="commit_edit('switch_autoreboot')" [checked]="user.vms[0].autoreboot === 1" class="custom-control-input" id="customSwitches">
                                <label class="custom-control-label" for="customSwitches">{{'vm.startOnBootDescription' | translate}}</label>
                            </div>
                        </div>
                        <div class="col-6 text-left">
                            <p *ngIf="user.admin"><b>{{'vm.owner' | translate}} :</b> {{ user.vms[0].user }}</p>

                            <p><b>{{'vm.createdOn' | translate}} :</b> {{user.vms[0].createdOn}}</p>

                            <p *ngIf="user.vms[0].status == 'running'"><b>{{'vm.upTime' | translate}} :</b> {{secondsToDhms( user.vms[0].uptime )}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h4>{{'vm.systemInformation' | translate}}</h4>
                    <hr>
                    <div class="text-left">
                        <p *ngIf="!editing"><b>{{'vm.cpu' | translate}} :</b>&nbsp; {{ user.vms[0].cpu }}</p>
                        <div class="progress flex-fill">
                            <div *ngIf="user.vms[0].cpuUsage <= 50" class="progress-bar progress-bar-animated"
                                 role="progressbar"
                                 aria-valuemin="0" aria-valuemax="100" style="width: {{user.vms[0].cpuUsage}}%">
                            </div>

                            <div *ngIf=" 50 < user.vms[0].cpuUsage && user.vms[0].cpuUsage <= 75"
                                 class="progress-bar progress-bar-animated bg-warning" role="progressbar"
                                 aria-valuemin="0" aria-valuemax="100" style="width: {{user.vms[0].cpuUsage}}%">
                            </div>

                            <div *ngIf=" 75 < user.vms[0].cpuUsage" class="progress-bar progress-bar-animated bg-danger"
                                 role="progressbar"
                                 aria-valuemin="0" aria-valuemax="100" style="width: {{user.vms[0].cpuUsage}}%">
                            </div>

                        </div>
                        <span *ngIf="user.vms[0].cpuUsage" style="float: right"
                              class="text-info"> {{user.vms[0].cpuUsage}}%</span>
                        <p style="padding-top: 5%" *ngIf="!editing"><b>{{'vm.ram' | translate}} :</b>&nbsp; {{ user.vms[0].ram }}</p>
                        <div class="progress flex-fill">
                            <div *ngIf="user.vms[0].ramUsage <= 50" class="progress-bar progress-bar-animated"
                                 role="progressbar"
                                 aria-valuemin="0" aria-valuemax="100" style="width: {{user.vms[0].ramUsage}}%">
                            </div>

                            <div *ngIf=" 50 < user.vms[0].ramUsage && user.vms[0].ramUsage <= 75"
                                 class="progress-bar progress-bar-animated bg-warning" role="progressbar"
                                 aria-valuemin="0" aria-valuemax="100" style="width: {{user.vms[0].ramUsage}}%">
                            </div>

                            <div *ngIf=" 75 < user.vms[0].ramUsage" class="progress-bar progress-bar-animated bg-danger"
                                 role="progressbar"
                                 aria-valuemin="0" aria-valuemax="100" style="width: {{user.vms[0].ramUsage}}%">
                            </div>
                        </div>
                        <span *ngIf="user.vms[0].ramUsage" style="float: right"
                              class="text-info">{{user.vms[0].ram * (user.vms[0].ramUsage / 100) | number:'1.1-2'}}
                            /{{user.vms[0].ram}} MB</span>
                        <!-- <p *ngIf="editing">{{newVm.disk}}<button (click)="add('disk')" class="btn btn-primary btn-sm">+</button></p> -->
                        <p *ngIf="!editing" style="padding-top: 5%"><b>{{'vm.diskSpace' | translate}} :</b>&nbsp; {{ user.vms[0].disk }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="btn-group">
                        <button type="button" *ngIf="user.vms[0].status != 'creating'" class="btn btn-danger" [disabled]="deletionStatus == 'deleting' || deletionStatus == 'deleted'"
                                (click)="delete_vm()">{{'vm.delete' | translate}}
                        </button>
                        <!-- <button type="button" class="btn btn-primary" *ngIf="!editing" (click)="edit()">Edit</button> -->
                        <!--<button type="button" class="btn btn-primary" *ngIf="editing" (click)="editing = false;">Confirm</button>-->
                        <button type="button" class="btn btn-info" *ngIf="user.vms[0].status == 'stopped'"  [disabled]="deletionStatus == 'deleting' || deletionStatus == 'deleted'"
                                (click)="commit_edit('start')">{{'vm.start' | translate}}
                        </button>
                        <button type="button" class="btn btn-info" *ngIf="user.vms[0].status == 'running'" [disabled]="deletionStatus == 'deleting' || deletionStatus == 'deleted'"
                                (click)="commit_edit('stop')">{{'vm.stop' | translate}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="margin-top: 20px;" *ngIf="this.user.admin">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                        <h4>{{'vm.ipHistory' | translate}}</h4>
                        <hr>
                        <div class="text-center">{{'vm.ipHistoryDescription' | translate}}</div>
                        <table style="margin-top: px" class="table table-striped">
                            <thead>
                                <th scope="col">IP</th>
                                <th scope="col">Date</th>
                                <th scope="col">Vm ID</th>
                                <th scope="col">User ID</th>
                            </thead>
                            <tbody>
                                <tr scope="row" *ngFor="let lign of this.history; let i = index">
                                    <td *ngFor="let column of this.history[i]"> {{ column }}</td>
                                </tr>
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="alert alert-danger text-center" *ngIf="this.user.cotisation === 0">
    <b>{{'vm.subscription.expired_1' | translate}}</b>
    <p>{{'vm.subscription.expired_2' | translate}} <a href="https://payment.minet.net/">{{'vm.subscription.expired_3' | translate}}</a> {{'vm.subscription.expired_4' | translate}}</p>
</div>
<div class="alert alert-danger text-center" *ngIf="!this.user.chartevalidated && !user.admin && this.user.cotisation ===1">
    <b>{{'vm.charter.notsigned_1' | translate}}</b>
    <p>{{'vm.charter.notsigned_2' | translate}} <a href="https://chartes.minet.net/">{{'vm.charter.notsigned_3' | translate}}</a> {{'vm.charter.notsigned_4' | translate}}</p>
</div>



