<div class="home container flex-fill">
  <h1 class="text-center mb-2">Home</h1>
  <hr>
  <div *ngIf="!user.admin" class="userhome">
    <div class="alert alert-info text-center" role="alert">
      <h3 class="alert-heading">
        Here you can create a virtual machine which will host your website or whichever service you want.
      </h3>
      <hr>
      <p>
        Be sure to read our <a [routerLink]="['rules']">rules</a> and our user's manual before. Do not hesitate to contact our <a href="mailto:webmaster@listes.minet.net"> webmaster</a> for any question.
      </p>
    </div>

    <div class="card mb-3">
      <h4 class="card-header">
        Create your VM
      </h4>
      <div class="card-body">
        <p class="lead">Overview of the available machine types</p>
        <dl>
          <dt>Bare VM</dt>
          <dd>Bare Debian 10 VM, use it as storage, compute machine or test machine.</dd>
          <dt>Simple web server</dt>
          <dd>Wordpress ready to use with ftps server.</dd>
        </dl>
        <hr>
        <div>
          <form (ngSubmit)="create_vm(vm)" #vmForm="ngForm">
            <div *ngIf="!vmForm.submitted">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="type-select-prepend">Type</span>
                </div>
                <select class="form-control" id="type"
                        aria-label="Type"
                        aria-describedby="type-select-prepend"
                        required
                        [(ngModel)]="vm.type" name="type"
                        #type="ngModel">
                  <option *ngFor="let image of images" [value]="image.id">{{image.name}}</option>
                </select>
              </div>
              <div [hidden]="type.valid || type.pristine" class="alert alert-danger">
                Type is required
              </div>

              <div *ngIf="!type.pristine">
                <div class="form-group">
                  <label for="name">VM name</label>
                  <input type="text" class="form-control" id="name"
                         required
                         [(ngModel)]="vm.name" name="name"
                         #name="ngModel">

                </div>
                <div [hidden]="name.valid || name.pristine"
                     class="alert alert-danger">
                  Name is required
                </div>

                <div class="form-group">
                  <label for="type">SSH key auth</label>
                  <select class="form-control" id="ssh"
                          required
                          [(ngModel)]="vm.ssh" name="ssh"
                          #type="ngModel" #ssh="ngModel">
                    <option>Yes</option>
                    <option>No</option>
                  </select>
                  <div [hidden]="type.valid || type.pristine" class="alert alert-danger">
                    SSH key auth is required
                  </div>
                </div>

                <div *ngIf="ssh.value == 'Yes'" class="form-group">
                  <label for="sshKey">SSH key</label>
                  <input type="text" class="form-control" id="sshKey"
                         [(ngModel)]="vm.sshKey" name="sshKey"
                         #sshKey="ngModel">
                </div>

                <div class="form-group">
                  <label for="user">VM user</label>
                  <input type="text" class="form-control" id="user"
                         [(ngModel)]="vm.user" name="user"
                         required="required"
                         #user="ngModel">
                </div>
                <div [hidden]="user.valid || user.pristine" class="alert alert-danger">
                  User is required
                </div>

                <div class="form-group">
                  <label for="password">Password</label>
                  <input type="password" class="form-control" id="password"
                         [(ngModel)]="vm.password" name="password"
                         #password="ngModel"
                         required="required">
                </div>
                <div [hidden]="password.valid || password.pristine" class="alert alert-danger">
                  Password is required
                </div>

                <div class="form-check mb-2 text-center m-3">
                  <input (click)="rules_checked()" [checked]="rulesCheck" id="checkbox" type="checkbox" class="form-check-input">
                  <label class="form-check-label" for="checkbox">I agree with MiNET's and MiNET's Hosting service <a [routerLink]="['rules']">rules</a>.</label>
                </div>
              </div>
              <div class="text-center">
                <button *ngIf="vmForm.valid && rulesCheck" type="submit" class="btn btn-primary text-center">Submit</button>
              </div>
            </div>
          </form>

        </div>
        <div class="text-center" *ngIf="vmForm.submitted && loading">
          Your VM is being created, please wait
          <p *ngIf="progress == 100">Your VM has been created, click <a [routerLink]="['vms']">here</a></p>
        </div>

        <div class="progress" *ngIf="vmForm.submitted && loading">
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: {{progress}}%"></div>
        </div>


      </div>
    </div>
  </div>
  <div *ngIf="user.admin" class="adminmenu">
    <p>Welcom to the hosting administration panel.<br>
      Here you can manage all the VM and the DNS entry.</p>
    <h2>Statistics</h2>
    <br>
    <div class="row">
      <div class="col-sm-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Created VM</h5>
            <a class="btn btn-primary">{{ countvm }}</a>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Active VM</h5>
            <a class="btn btn-primary">{{ countactivevm }}</a>
          </div>
        </div>
      </div>
    </div>
  </div>
